http请求过程可分为三部分

* 三次握手，建立连接
* TCP通htt信
* 四次挥手，断开链接

释义

* ACK的全称为Acknowledge character，即确认字符，表示接收到的字符无错误。
* 否认字符NAK( Negative Acknowledge)的含义为接收站对所收到的报文进行检查，若发现错误，便向发送站发送否认回答NAK，表示报文有错，并要求重发。
* 同步字符SYN( Synchronize Sequence Numbers)表示无论是中心结点还是远地结点，在发送信息或回答之前，都要先发送同步字符，用以实现或保持发送站和接收站之间的同步。
*

三次握手
![http1](/images/http1.jpg)

四次挥手
![http2](/images/http2.jpg)

为什么断开连接需要四次

* 基于tcp协议的双方是双全工的，也就是说通信双方都可以向对方发送消息，也都可以独立关闭自己一方的通信通道。
* 基于通信方式和双全工的特性，所以在tcp连接建立时
* client需要将自己的ISN序号告知对方，同时需要对方的确定。
* server也需要将自己的ISN序号告知对方，同时也要对方的确定。
* server将自己的ack和发出的syn标志的告知对方ISN的合并在一次传递中，这样子节省流量。所以三次握手很合理。
*
* client先发送FIN告知对方我已经完成数据发送了，server回复ack来确定我知道了。这样一个流程，就关闭了client的发送信息通道。但是还可以接收来自server方的数据。
* server此时已经知道接收不到client的数据了，但是还可以给它发送数据。如果server也没有啥数据要发送给对方了，server也会以FIN标志位发送一个信息给client，client接到后，也会传递一个ack表示知道了。这样子，双方都完成了关闭。

TCP通信：

* 数据包编号（seq）：
  * TCP协议发送数据时，会给每个数据包编号（seq）。接收方可以按编号还原顺序，丢包时也可以得知丢失的是哪个数据包。
  * 第一个包的编号是一个随机数
  * 下一个包的编号=上一个包的编号（seq）+上一个包的负载（length）
  * 按顺序组装好之后，操作系统会根据TCP数据包中的端口，转交给应用程序（因此端口号不能冲突）
* 一次TCP通信可以包括多个HTTP通信
* 慢启动机制：
  * 开始时发送较慢，然后根据丢包情况调整
  * 不丢包，就认为网络状况良好，加快发送速度
  * 丢包，就认为网络状况较差，防止发的越快丢得越多，降低发送速度
* 确认包（ACK）：
  * 发送方会通过接收方返回的确认包（ACK）来判断是否丢包
  * 默认情况下，接收方每收到两个TCP数据包，就要发送一个ACK确认包，发送方收到确认包之后再继续发送
  * ACK携带两个信息：
    * 下一个应该接收的数据包编号：
      * =上一个包的编号（seq）+上一个包的负载（length）
    * 接收方接收窗口的剩余容量
  * 发送方会根据ACK中携带的信息来推测接收速度，调整发送速度
  * 由于TCP是双向的，所以双方都需要发送ACK，ACK通常和数据包合在一起发送
* 丢包处理：
  * 发送方连续三次收到重复的ACK，或超时了都没有收到ACK，就会认为丢包
  * 丢失哪个就会重发哪个
  * 如果有一个数据包丢失，接收方即使收到了其他数据包，也会继续重复发丢失的ACK
